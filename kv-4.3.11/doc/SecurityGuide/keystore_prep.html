<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Appendix C. Java KeyStore Preparation</title>
    <link rel="stylesheet" href="gettingStarted.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="start" href="index.html" title="Oracle NoSQL Database Security Guide" />
    <link rel="up" href="index.html" title="Oracle NoSQL Database Security Guide" />
    <link rel="prev" href="appendix_keytool.html" title="Appendix B. SSL keystore generation" />
    <link rel="next" href="required_privileges.html" title="Appendix D. KVStore Required Privileges" />
  </head>
  <body>
    <div xmlns="" class="navheader">
      <div class="libver">
        <p>Library Version 12.1.4.3</p>
      </div>
      <table width="100%" summary="Navigation header">
        <tr>
          <th colspan="3" align="center">Appendix C. Java KeyStore Preparation</th>
        </tr>
        <tr>
          <td width="20%" align="left"><a accesskey="p" href="appendix_keytool.html">Prev</a> </td>
          <th width="60%" align="center"> </th>
          <td width="20%" align="right"> <a accesskey="n" href="required_privileges.html">Next</a></td>
        </tr>
      </table>
      <hr />
    </div>
    <div class="appendix" lang="en" xml:lang="en">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="keystore_prep"></a>Appendix C. Java KeyStore Preparation</h2>
          </div>
        </div>
      </div>
      <p>
        The following example demonstrates how to use
        <code class="literal">keytool</code> to prepare keystore and truststore with
        external certificate. If you want to import an existing
        private/public key pair generated by an external tool instead, see
        <a class="xref" href="keystore_prep.html#import_keypair" title="Import Key Pair to Java Keystore">Import Key Pair to Java Keystore</a>.
	</p>
      <div class="orderedlist">
        <ol type="1">
          <li>
            <p>
				Generate a keypair and store it into store.keys
			</p>
            <pre class="programlisting">keytool -genkeypair -keystore store.keys \
-alias shared -keyAlg RSA -keySize 2048 \
-validity 365 -dname &lt;xxx&gt; \
-storepass &lt;sslPwd&gt;
...
Enter key password for &lt;shared&gt;
(RETURN if same as keystore password): </pre>
            <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
              <h3 class="title">Note</h3>
              <p>
                <code class="literal">Store.keys</code> is the default name of Oracle NoSQL Database
                keystore and <code class="literal">shared</code> is the default alias
                of the Oracle NoSQL Database certificate You can customize the name by
                specifying a security parameter in the makebootconfig
                command or the securityconfig utility. Additionally, you
                can specify the algorithm, size and validity of key.
			</p>
            </div>
          </li>
          <li>
            <p>
				Generate a certificate request and send to CA.
			</p>
            <pre class="programlisting">keytool -certreq -keystore store.keys -alias
shared -file myhost.csr
Enter keystore password: </pre>
          </li>
          <li>
            <p>
                A public trusted CA usually signs the certificate after
                receiving your csr file. A pem file is generated
                (myhost.cert.pem).
			</p>
          </li>
          <li>
            <p>
             Import certificates that are part of a certificate chain in
             order. If there are multiple intermediate certificates, they
             also need to be imported in order.
			</p>
            <pre class="programlisting">keytool -import -file ca.cert.pem
-keystore store.keys -alias root
keytool -import -file intermediate.cert.pem -keystore store.keys
-alias intermediate
# After importing the root and intermediate certificates,
# install the signed certificate for this server. The alias name
# must be specified.
keytool -import -file myhost.cert.pem -keystore store.keys
-alias shared
Certificate reply was installed in keystore </pre>
          </li>
          <li>
            <p>
                Verify the installation by checking the certificate content
                in <code class="literal">store.keys</code>:
			</p>
            <pre class="programlisting">keytool -list -v -keystore store.keys -alias shared
Certificate chain length: 3
Certificate[1]:
Owner: CN=myhost, OU=TeamA, O=MyCompany, L=Unknown, 
ST=California, C=US
Issuer: CN=intermediate CA, OU=CA, O=MyCompany, 
ST=California, C=US </pre>
            <p>
                The certificate chain length should match the number of
                certificates in the chain that were imported, in this case,
                three.
			</p>
          </li>
          <li>
            <p>
                Build server truststore (store.trust). The server
                truststore must contain the signed certificate as well as
                the root and intermediate certificate. Note that the server
                and client truststores need to use the same password as
                that of the keystore.
			</p>
            <pre class="programlisting">keytool -export -file store.tmp
-keystore store.keys -alias shared
keytool -import -keystore store.trust -file store.tmp
keytool -import -keystore store.trust -file ca.cert.pem
-alias root
keytool -import -keystore store.trust -file intermediate.cert.pem
-alias intermediate </pre>
          </li>
          <li>
            <p>
                Create client truststore (client.trust). In this case,
                import the root and intermediate certificates into the
                client truststore.
			</p>
            <pre class="programlisting">keytool -import -keystore client.trust
-file ca.cert.pem -alias root
keytool -import -keystore client.trust -file intermediate.cert.pem
-alias intermediate </pre>
          </li>
        </ol>
      </div>
      <div class="sect1" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a id="import_keypair"></a>Import Key Pair to Java Keystore</h2>
            </div>
          </div>
        </div>
        <p>
        This section describes how to import an existing private/public key
        pair into Java keystore. This is useful if you have your own tools
        for generating a CA signed key pair. The procedure assumes you
        already have the root and intermediate certificates as well as the
        private key and its signed certificate.
	</p>
        <p>
		To import an existing key pair:
	</p>
        <div class="orderedlist">
          <ol type="1">
            <li>
              <p>
                Build the certificate chain and convert the private key and
                certificate files into a PKCS12 file.
			</p>
              <pre class="programlisting">cat myhost.pem intermediate.pem root.pem &gt; import.pem
openssl pkcs12 -export -in import.pem -inkey myhost.key.pem
-name shared &gt; server.p12</pre>
            </li>
            <li>
              <p>
				Import the PKCS12 file into Java keystore:
			</p>
              <pre class="programlisting">keytool -importkeystore -srckeystore server.p12
-destkeystore store.keys -srcstoretype pkcs12 -alias shared </pre>
            </li>
            <li>
              <p>
                Finally, to complete the preparation of the Java keystore,
                perform the procedures for creating the server and client
                truststore described in the previous section.
			</p>
            </li>
          </ol>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <hr />
      <table width="100%" summary="Navigation footer">
        <tr>
          <td width="40%" align="left"><a accesskey="p" href="appendix_keytool.html">Prev</a> </td>
          <td width="20%" align="center"> </td>
          <td width="40%" align="right"> <a accesskey="n" href="required_privileges.html">Next</a></td>
        </tr>
        <tr>
          <td width="40%" align="left" valign="top">Appendix B. SSL keystore generation </td>
          <td width="20%" align="center">
            <a accesskey="h" href="index.html">Home</a>
          </td>
          <td width="40%" align="right" valign="top"> Appendix D. KVStore Required Privileges</td>
        </tr>
      </table>
    </div>
  </body>
</html>
